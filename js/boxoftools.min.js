async function getJson(e){return(await fetch(e)).json()}var structureObject={};async function loadDataAndPageEvents(){for(structureObject=JSON.parse(JSON.stringify(await getJson("./js/data.min.json"))),i=0;i<2;i++)newstructure();document.getElementById("newstrutbtn").addEventListener("click",function(){newstructure()}),document.getElementById("resetbtn").addEventListener("click",function(){resetTable()}),document.getElementById("perMinTab").addEventListener("click",recompute),document.getElementById("perHourTab").addEventListener("click",recompute)}function deleteStructure(){const e=this.parentNode.parentNode;e.parentNode.removeChild(e),recompute()}function resetTable(){for(document.getElementById("structuretable").lastElementChild.replaceChildren(),i=0;i<2;i++)newstructure();recompute()}function getIndexById(e,t){return t.findIndex(function(t){return t.id==e})}function setAttributes(e,t){for(let l in t)e.setAttribute(l,t[l])}function getColumnCells(e,t,l){const n=[];if(t>l)for(let r=0;r<e.length;r+=t){const a=e.slice(r,r+t);l>a.length?n.push(null):n.push(a[l])}return n}function newstructure(){function e(e){const t=document.createElement("td");return e.appendChild(t),t}function t(e,t){let l=Array.from(document.querySelector("#structuretable").querySelectorAll("select"));return document.getElementById(l.at(getIndexById(e.target.id,l)+t).getAttribute("id"))}const l=Object.keys(structureObject),n=document.createElement("tr"),r=e(n),a=document.createElement("select");setAttributes(a,{id:"id"+Math.random().toString(16).slice(2),class:"form-select","aria-label":"Structure Selection Field"}),a.addEventListener("change",function(e){let l=t(e,1),n=t(e,2);l.length=1,n.value=1,n.setAttribute("disabled",""),recompute(),"0"==this.value?(l.setAttribute("disabled",""),n.setAttribute("disabled","")):(l.removeAttribute("disabled",""),n.removeAttribute("disabled",""));let r=this.value,a=Object.keys(Object.values(structureObject)[r]);for(;l.firstChild;)l.firstChild.remove();for(let e=0;e<a.length;e++)l.options[l.options.length]=new Option(a[e],r[e])});for(let e=0;e<l.length;e++)a.options[a.options.length]=new Option(l[e],e),r.appendChild(a);const c=e(n),s=document.createElement("select");setAttributes(s,{id:"id"+Math.random().toString(16).slice(2),class:"form-select","aria-label":"Task Selection Field",disabled:""}),s.addEventListener("change",function(e){recompute()});let i=Object.keys(Object.values(structureObject)[0]);for(let e=0;e<i.length;e++)s.options[s.options.length]=new Option(i[e],[e]),c.appendChild(s);const d=e(n),o=document.createElement("select");o.addEventListener("change",recompute),setAttributes(o,{id:"id"+Math.random().toString(16).slice(2),class:"form-select","aria-label":"Amount Selection Field",disabled:""});for(let e=1;e<21;e++)o.options[o.options.length]=new Option(e),d.appendChild(o);const u=e(n),m=document.createElement("button");m.addEventListener("click",deleteStructure),m.insertAdjacentHTML("afterbegin",'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash-fill" viewBox="0 0 16 16"><path d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1H2.5zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zM8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5zm3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0z"/></svg>'),setAttributes(m,{class:"btn btn-danger",type:"button",value:"Remove Structure","aria-label":"Delete Row"}),u.appendChild(m),(document.getElementById("structuretable").querySelector("tbody")||table).appendChild(n)}function setText(e,t){document.getElementById(e).innerHTML=t}function powerlimit(e){let t=parseFloat(e);return Math.min(Math.max(t,0),30)}function tidy(e){return Math.round(100*e)/100}function recompute(){let e=Array(39).fill(0),t=Array.from(document.querySelector("#structuretable").querySelectorAll("select")),l=getColumnCells(t,3,0),n=[];for(let e=0;e<l.length;e++){let r=Object.keys(structureObject)[l[e].value],a=Object.keys(structureObject[r])[getColumnCells(t,3,1)[e].selectedIndex],c=getColumnCells(t,3,2)[e].value,s=Object.values(structureObject[r][a]);for(let e=0;e<c;e++)n.push(s)}for(let t=0;t<n.length;t++){let l=n[t];e=e.map(function(e,t){return e+l[t]})}let r=["PowerGen","PowerCon","fWater","fOil","fPetrol","fDiesel","fHOil","fEOil","cMats","pCMats","sCMats","asMat1","asMat2","asMat3","asMat4","asMat5","aFlame","a250","a3c","a4c","a75","a945","a300","a120","a150","rScrap","rCoal","rCoke","rComp","rDComp","rSulfur","rEMat","rHEMat","mGsupp","mSand","mBarb","mMBeam","mConc","mPipe"];for(let t=0;t<r.length;t++)r[t].includes("PowerGen")?setText(r[0],powerlimit(e[0])):r[t].includes("PowerCon")?setText(r[t],e[t]):document.getElementById("perHourTab").getAttribute("class").includes("active")?setText(r[t],tidy(60*e[t])):setText(r[t],tidy(e[t]));setText("PowerFree",powerlimit(e[0]-e[1]))}loadDataAndPageEvents(),function(){let e=document.getElementById("lightSwitch");var t;e&&(null==(t=localStorage.getItem("lightSwitch"))&&(t=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),"dark"==t&&(e.checked=!0),e.addEventListener("change",l),l());function l(){e.checked?function(){document.querySelectorAll(".bg-light").forEach(e=>{e.className=e.className.replace(/-light/g,"-dark")}),document.body.classList.add("bg-dark"),document.body.classList.contains("text-dark")?(document.getElementById("titleText").classList.replace("text-dark","text-light"),document.getElementById("structuretable").parentNode.classList.replace("bg-light","bg-dark"),document.body.classList.replace("text-dark","text-light")):(document.getElementById("titleText").classList.add("text-light"),document.getElementById("structuretable").parentNode.classList.add("bg-dark"),document.body.classList.add("text-light")),document.getElementById("lightSwitchIcon").getAttribute("fill").includes("black")&&document.getElementById("lightSwitchIcon").setAttribute("fill","white");for(var t=document.querySelectorAll("table"),l=0;l<t.length;l++)t[l].classList.add("table-dark");e.checked||(e.checked=!0),localStorage.setItem("lightSwitch","dark")}():function(){document.querySelectorAll(".bg-dark").forEach(e=>{e.className=e.className.replace(/-dark/g,"-light")}),document.body.classList.add("bg-light"),document.body.classList.contains("text-light")?(document.getElementById("titleText").classList.replace("text-light","text-dark"),document.getElementById("structuretable").parentNode.classList.replace("bg-dark","bg-light"),document.body.classList.replace("text-light","text-dark")):(document.getElementById("titleText").classList.add("text-dark"),document.getElementById("structuretable").parentNode.classList.add("bg-light"),document.body.classList.add("text-dark")),document.getElementById("lightSwitchIcon").getAttribute("fill").includes("white")&&document.getElementById("lightSwitchIcon").setAttribute("fill","black");for(var t=document.querySelectorAll("table"),l=0;l<t.length;l++)t[l].classList.contains("table-dark")&&t[l].classList.remove("table-dark");e.checked&&(e.checked=!1),localStorage.setItem("lightSwitch","light")}()}}();